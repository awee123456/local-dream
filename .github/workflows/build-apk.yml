name: Build Android APK (Native Engine Optimized)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. ดึงโค้ดโปรเจกต์ (Recursive เพื่อเอา Submodules ทั้งหมด)
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          repository: xororz/local-dream
          submodules: recursive
          token: ${{ secrets.GH_TOKEN }}

      # 2. เตรียม Java สำหรับ Gradle
      - name: Set up Java 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # 3. ล้างพื้นที่ (เพื่อป้องกันพื้นที่เต็มระหว่าง Compile Native Code)
      - name: Free Disk Space
        run: |
          sudo rm -rf /usr/share/dotnet /opt/ghc "/usr/local/share/boost"

      # 4. ติดตั้งเครื่องมือ Build
      - name: Install Build Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y cmake ninja-build build-essential python3-pip dos2unix
          pip3 install gdown

      # 5. ติดตั้ง Rust 1.84.0 สำหรับ Android aarch64
      - name: Install Rust 1
